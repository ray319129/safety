# 接下來該做的事項 - 完整檢查清單

## 階段一：硬體組裝與連接 ✅

### 1. 準備所有硬體元件
- [ ] Raspberry Pi 4 (4GB)
- [ ] BMduino-UNO (BM53A367A)
- [ ] Logitech C920e 攝影機
- [ ] NEO-M8 GPS 模組
- [ ] L298N 馬達驅動模組
- [ ] **DC 馬達 x2**（履帶用，左右各一）
- [ ] 360度伺服馬達 x2
- [ ] ISD1820 警報模組
- [ ] LED 燈條 + MOSFET
- [ ] 光感測模組
- [ ] 18650 電池組（4 顆）+ 電池座
- [ ] 降壓模組（12V→5V）
- [ ] 杜邦線、跳線、電源線
- [ ] USB-C 電源供應器（5V, 3A）

### 2. 連接 BMduino 到 Raspberry Pi（UART）
- [ ] BMduino D0 (RX) → Raspberry Pi GPIO 14 (TX, Pin 8)
- [ ] BMduino D1 (TX) → Raspberry Pi GPIO 15 (RX, Pin 10)
- [ ] BMduino GND → Raspberry Pi GND

### 3. 連接 L298N 馬達驅動到 BMduino
- [ ] L298N IN1 → BMduino D5
- [ ] L298N IN2 → BMduino D6
- [ ] L298N ENA → BMduino D9
- [ ] L298N IN3 → BMduino D10
- [ ] L298N IN4 → BMduino D11
- [ ] L298N ENB → BMduino D3
- [ ] L298N GND → BMduino GND
- [ ] L298N VCC → 外部電源（5V/12V，依馬達規格）
- [ ] L298N OUT1/OUT2 → **左馬達**（兩條線）
- [ ] L298N OUT3/OUT4 → **右馬達**（兩條線）

### 4. 連接伺服馬達到 BMduino
- [ ] 伺服 1 訊號線 → BMduino D4
- [ ] 伺服 2 訊號線 → BMduino D7
- [ ] 伺服電源 → 外部 5V（注意電流需求）
- [ ] 伺服 GND → BMduino GND

### 5. 連接 ISD1820 警報模組到 BMduino
- [ ] ISD1820 PLAY → BMduino D8
- [ ] ISD1820 GND → BMduino GND
- [ ] ISD1820 VCC → 5V

### 6. 連接 LED 燈條到 BMduino
- [ ] MOSFET Gate → BMduino D12
- [ ] MOSFET Drain → LED 燈條負極
- [ ] MOSFET Source → GND
- [ ] LED 燈條正極 → 外部電源（12V/5V）

### 7. 連接光感測模組到 BMduino
- [ ] 光感測輸出 → BMduino A0
- [ ] 光感測 VCC → 3.3V 或 5V
- [ ] 光感測 GND → BMduino GND

### 8. 連接 GPS 模組到 Raspberry Pi
- [ ] GPS TX → Raspberry Pi UART RX（/dev/ttyAMA0）
- [ ] GPS RX → Raspberry Pi UART TX（/dev/ttyAMA0）
- [ ] GPS GND → Raspberry Pi GND
- [ ] GPS VCC → 3.3V 或 5V

### 9. 連接攝影機到 Raspberry Pi
- [ ] Logitech C920e → Raspberry Pi USB 埠

### 10. 電源連接
- [ ] Raspberry Pi USB-C 電源供應器
- [ ] 18650 電池組 → 降壓模組 → 各模組電源
- [ ] **所有模組 GND 共地連接**

---

## 階段二：軟體設定與燒錄

### 1. Raspberry Pi 設定
- [ ] 安裝 Raspberry Pi OS (64-bit)
- [ ] 啟用 UART（`enable_uart=1`）
- [ ] 設定序列埠權限（加入 `dialout` 群組）
- [ ] 安裝 Python 3 和 pip
- [ ] 建立虛擬環境（`venv`）
- [ ] 安裝 Python 依賴套件

### 2. BMduino 韌體燒錄
- [ ] 安裝 Arduino IDE
- [ ] 安裝 BMduino 開發板支援
- [ ] 開啟 `bmduino/bmduino_firmware.ino`
- [ ] 選擇開發板：BMduino-UNO (HT32F52367)
- [ ] 使用 USB 連接 BMduino 到電腦
- [ ] 上傳韌體
- [ ] 確認波特率為 9600
- [ ] 斷開 USB，改用 UART 連接

### 3. 環境變數設定
- [ ] 在 `vehicle/.env` 設定 BMduino 埠號和波特率
- [ ] 在 `vehicle/.env` 設定後端 API URL
- [ ] 在 `backend/.env` 設定 MongoDB 連接
- [ ] 在 `backend/.env` 設定車載端 IP

---

## 階段三：功能測試

### 1. UART 通信測試
- [ ] 執行 `test_uart.py` 測試 BMduino 連接
- [ ] 確認可以發送指令並接收回應
- [ ] 測試所有指令（M, S, A, L, Q）

### 2. 馬達測試
- [ ] 測試左馬達前進/後退/停止
- [ ] 測試右馬達前進/後退/停止
- [ ] 測試雙馬達同步運轉
- [ ] 確認履帶可以正常移動

### 3. 伺服測試
- [ ] 測試伺服 1 升起/降下
- [ ] 測試伺服 2 升起/降下
- [ ] 確認警示牌可以正常升降

### 4. 警報測試
- [ ] 測試 ISD1820 播放功能
- [ ] 確認警報音正常

### 5. LED 測試
- [ ] 測試 LED 亮度控制（0-255）
- [ ] 測試光感測自動亮度（如已啟用）

### 6. GPS 測試
- [ ] 確認 GPS 可以取得座標
- [ ] 測試距離計算功能

### 7. 視覺辨識測試
- [ ] 確認攝影機可以正常讀取影像
- [ ] 測試人體偵測功能
- [ ] 確認 Bounding Box 可以正常顯示

---

## 階段四：系統整合測試

### 1. 完整流程測試
- [ ] 啟動車載程式
- [ ] 確認所有模組初始化成功
- [ ] 確認 GPS 可以取得位置
- [ ] 確認人體偵測正常運作
- [ ] 確認事故上報功能正常
- [ ] 確認 BMduino 警示觸發正常

### 2. 後端測試
- [ ] 啟動後端伺服器
- [ ] 確認 MongoDB 連接正常
- [ ] 測試事故上報 API
- [ ] 測試事故查詢 API
- [ ] 測試管理員登入功能

### 3. 前端測試
- [ ] 開啟前端網頁
- [ ] 確認地圖正常顯示
- [ ] 確認事故標記正常顯示
- [ ] 確認即時影像串流正常
- [ ] 測試管理員功能（登入、刪除事故）
- [ ] 測試偵測框開關功能

### 4. 端對端測試
- [ ] 完整測試：啟動 → 偵測 → 上報 → 顯示
- [ ] 確認所有功能正常運作
- [ ] 記錄任何錯誤或問題

---

## 階段五：優化與調整

### 1. 參數調整
- [ ] 調整人體偵測信心度閾值
- [ ] 調整馬達速度參數
- [ ] 調整伺服角度
- [ ] 調整 LED 亮度映射

### 2. 效能優化
- [ ] 優化影像處理速度
- [ ] 優化 GPS 更新頻率
- [ ] 優化網路傳輸

### 3. 穩定性測試
- [ ] 長時間運行測試
- [ ] 異常情況處理測試
- [ ] 斷線重連測試

---

## 階段六：部署與文檔

### 1. 部署準備
- [ ] 準備部署腳本
- [ ] 準備啟動腳本
- [ ] 準備系統服務設定（如需要）

### 2. 文檔完善
- [ ] 更新 README.md
- [ ] 更新 API 文檔
- [ ] 更新故障排除指南
- [ ] 建立使用者手冊

### 3. 版本控制
- [ ] 確認所有程式碼已提交到 GitHub
- [ ] 建立版本標籤
- [ ] 準備發布說明

---

## 重要提醒

1. **安全第一**
   - 測試時注意電源安全
   - 避免短路
   - 注意散熱

2. **逐步測試**
   - 不要一次連接所有元件
   - 先測試單一模組，再整合測試

3. **記錄問題**
   - 記錄所有遇到的問題
   - 記錄解決方法
   - 更新文檔

4. **備份**
   - 定期備份程式碼
   - 備份配置檔案
   - 備份重要資料

---

## 快速檢查清單

### 硬體連接
- [ ] UART 連接（交叉連接 + 共地）
- [ ] L298N 連接（6 條控制線 + 電源 + 馬達）
- [ ] 伺服連接（2 條訊號線 + 電源 + 共地）
- [ ] ISD1820 連接（1 條控制線 + 電源 + 共地）
- [ ] LED 連接（MOSFET + 電源）
- [ ] 光感測連接（類比輸入 + 電源 + 共地）
- [ ] GPS 連接（UART + 電源 + 共地）
- [ ] 攝影機連接（USB）

### 軟體設定
- [ ] Raspberry Pi UART 啟用
- [ ] BMduino 韌體燒錄（9600 baud）
- [ ] 環境變數設定
- [ ] Python 依賴安裝

### 功能測試
- [ ] UART 通信測試
- [ ] 馬達測試
- [ ] 伺服測試
- [ ] 警報測試
- [ ] LED 測試
- [ ] GPS 測試
- [ ] 視覺辨識測試
- [ ] 完整流程測試

---

## 完成標準

系統被認為完成時，應該能夠：
1. ✅ 啟動時自動取得 GPS 位置
2. ✅ 自動偵測是否有民眾受傷
3. ✅ 自動上報一次事故（包含 `has_injured` 資訊）
4. ✅ 透過 BMduino 觸發實體警示（如有民眾受傷）
5. ✅ 持續提供即時影像串流
6. ✅ 前端可以正常顯示事故和影像
7. ✅ 管理員可以登入和管理事故

---

## 下一步行動

1. **立即執行**：按照階段一完成所有硬體連接
2. **軟體設定**：完成階段二的軟體設定和燒錄
3. **功能測試**：完成階段三的單一模組測試
4. **整合測試**：完成階段四的系統整合測試
5. **優化部署**：完成階段五和六的優化和部署

祝您專案順利！
